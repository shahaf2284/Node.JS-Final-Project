<html>
    <head>
        <link rel="stylesheet" href="Style.css"/>
        <title>Plastic Factory - Login</title>
        <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    </head>
    
    <body onload="reload()" background="./backgroundimage.jpg" style="text-align: center">
        <h1 class="custom-heading-h1">Plastic Factory</h1><br>
        <h3 class="custom-heading-h3">Log-in page</h3>
        <table border="1">
            <tr>
                <th>
                    <div class="Enter-group">
                        <label for="username">Username</label>
                        <input type="text" id="username" placeholder="Enter Username" oninput="checkInputs()"><br>
                    </div>
                    <div class="Enter-group">
                        <label for="email">Email</label>
                        <input type="text" id="email" placeholder="Enter your email" oninput="checkInputs()"><br>
                    </div>
                    <div class="Enter-group" style="text-align: center">
                        <button id="submitButton" onclick="login()" disabled>Click</button>
                    </div>
                </th>
            </tr>
        </table>

        <h4 id="ErorrLOG" class="custom-heading-h3-h4" style="font-size: 15px;color:rgb(159, 1, 1)"></h4>

    </body>
    <script>

        function checkInputs(){

            // Get the input fields
            const username = document.getElementById('username').value;
            const email = document.getElementById('email').value;
            // Get the button element by its ID
            let submitButton = document.getElementById('submitButton');
            
            // Check if all fields are filled
            if (username && email) {

                    // Enable the button
                    submitButton.disabled = false;
                    // Add the 'enabled' class
                    submitButton.classList.add('enabled');
                }
        }

        function reload(){

            //clean all the input
            document.getElementById('username').value=""
            document.getElementById('email').value = ""

            const submitButton = document.getElementById('submitButton');
            // Enable the button
            submitButton.disabled = true;
            // Add the 'enabled' class
            submitButton.classList.add('disabled');

        }

        async function login(){
            const username = document.getElementById('username').value;
            const email = document.getElementById('email').value;
            const ErorrLOG = document.getElementById("ErorrLOG")

            const resp =   await fetch("http://localhost:8000/login", {
                                    method: "POST",
                                    headers: {"Content-Type": "application/json"}, 
                                    body: JSON.stringify({username: username, email: email})
                                })
            const data = await resp.json()
            console.log(data)
            if(data.employeeActionsLeft === 0){
                alert("You have no actions left")
                window.location.href = "./login.html"
            }
            if(!data.success){
                ErorrLOG.innerText = data.erorr
                reload()
            }
            else{

                // Set the token in header
                localStorage.setItem("token", data.token)
                reload()
                //move on to employee page
                window.location.href = "./userInfo.html"
            }
                
        }
                
    </script>
</html>

