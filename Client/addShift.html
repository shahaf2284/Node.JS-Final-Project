<html>
    <head>
        <link rel="stylesheet" href="Style.css"/>
        <title>Add Shift</title>
        <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    </head>
    <body onload="loadPage()">
        <h1 class="custom-heading-h1">Plastic Factory</h1>
        <h3 class="custom-heading-h3-h4" id="title">Hi ** would you like to add shift</h3><br>

        <div class="box" >
            <label for="Date" style="font-size: 17px;">Date</label>
            <input id="Date" class="EditeSifts" type="date"><br>
    
            <label for="Start time" style="font-size: 17px;">Start time</label>
            <input id="Stime" class="EditeSifts" type="time"><br>
    
            <label for="End time" style="font-size: 17px;">End time</label>
            <input id="Etime" class="EditeSifts" type="time"><br><br>
            
            <button id="submitButton" onclick="Update()">Update</button>
        </div><br>
        <div class="custom-heading-h3-h4">
            <p id="titleErorr" hidden="true">Please refer to the arguments:</p>
            <p id="erorrfields" hidden="true" style="color:rgb(150, 0, 0)"></p>
            <!-- <h3 class="custom-heading-h3-h4" id="erorrDate" style="color:rgb(150, 0, 0)"></h3><br>
            <h3 class="custom-heading-h3-h4" id="erorrTime" style="color:rgb(150, 0, 0)"></h3><br> -->
        </div>


    </body>
    <script>

        async function loadPage(){
            try{
                //get the token
                const token = localStorage.getItem("token");
                if(!token) {
                    alert("token not provided")
                    window.location.href = "./login.html"
                }
                //get request to get the employee data
                const resp = await fetch("http://localhost:8000/employee",{headers: { token: token }})
                const {data} = await resp.json()
    
                // Hi Leanne Graham would you like to do the shift
                const title = document.getElementById("title")
                title.innerHTML = title.innerHTML.replace("**", `${data.employeeName}`)
            }
            catch(e){
                console.log({erorr:e})
                window.location.href = `./login.html`
            }
        }

        async function Update(){

            const token = localStorage.getItem("token");

            let Date = document.getElementById("Date").value
            const Stime = document.getElementById("Stime").value
            const Etime = document.getElementById("Etime").value

            const erorrfields = document.getElementById("erorrfields")
            const titleErorr = document.getElementById("titleErorr")

            if(!Date || !Stime || !Etime){
                titleErorr.hidden = false
                erorrfields.hidden = false
                erorrfields.innerText = "One of the fields, empty"
                return
            }

            const [Start_hours,Start_minutes] = Stime.split(":")
            const [End_hours,End_minutes] = Etime.split(":")

            if (!(Number(End_hours) > Number(Start_hours)||
                    (Number(End_hours) === Number(Start_hours) && Number(End_minutes)>Number(Start_minutes)))){
                        titleErorr.hidden = false
                        erorrfields.hidden = false
                        erorrfields.innerText = "The start time is later than the end time"
                        return
            }

            const body = {
                    Date: setUpDate(Date), 
                    Start_Time: Stime,
                    End_Time:Etime                                            
                }
            console.log(body)
            //Send post request 
            const resp =   await fetch("http://127.0.0.1:8000/employee/shift", {
                                    method: "POST",
                                    headers: {"Content-Type": "application/json", token:token}, 
                                    body: JSON.stringify(body)
                                })
            const data = await resp.json()
            console.log(data)
            window.location.href = `./employee.html`

        }

        function setUpDate(Date){
            const words = Date.split("-")
            return words[2] + "-" + words[1] + "-" +  String(Number(words[0])-2000)
        }

    
    </script>
</html>